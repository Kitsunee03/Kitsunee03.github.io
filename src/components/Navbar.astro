---
import { SITE_TITLE, NAV_LINKS as links } from "@/consts";
---

<nav class="w-full !z-[9999] py-4 px-4 bg-black/90 backdrop-blur-sm">
  <div
    class="max-w-6xl mx-auto flex items-center justify-between px-4 md:px-8"
  >
    <a href="/">
      <div
        id="logo"
        class="pt-2 pb-1 !grid !place-items-center select-none leading-none hover:bg-black bg-white scale-110 hover:text-white text-black px-4 transition-all ease-in-out"
      >
        {SITE_TITLE}
      </div>
    </a>

    <!-- Desktop nav -->
    <div class="hidden md:flex items-center gap-1">
      <span class="text-[var(--text-muted)]">/</span>
      {
        links.map((link, i) => {
          const href = link.href;
          const pathname = Astro.url.pathname.replace(
            import.meta.env.BASE_URL,
            "",
          );
          const isActive =
            href === "/" 
              ? pathname === "" || pathname === "/" 
              : pathname.startsWith(href.slice(1));
          return (
            <>
              <a
                class:list={[
                  "hover:bg-white hover:text-black transition-all ease-in-out px-3 py-1 rounded-md",
                  { "bg-white text-black": isActive },
                ]}
                href={href}
              >
                {link.title}
              </a>
              <span class="text-[var(--text-muted)]">/</span>
            </>
          );
        })
      }
    </div>

    <!-- Mobile hamburger -->
    <button
      id="mobile-menu-btn"
      class="md:hidden flex flex-col gap-1.5 p-2 hover:bg-white/10 transition-colors"
      aria-label="Menu"
    >
      <span class="block w-6 h-0.5 bg-white transition-transform" id="bar1"></span>
      <span class="block w-6 h-0.5 bg-white transition-opacity" id="bar2"></span>
      <span class="block w-6 h-0.5 bg-white transition-transform" id="bar3"></span>
    </button>
  </div>

  <!-- Mobile menu -->
  <div
    id="mobile-menu"
    class="hidden md:hidden max-w-6xl mx-auto mt-4 px-4 pb-2 border-t border-[var(--border-color)]"
  >
    <div class="flex flex-col gap-2 pt-4">
      {
        links.map((link) => {
          const href = link.href;
          const pathname = Astro.url.pathname.replace(
            import.meta.env.BASE_URL,
            "",
          );
          const isActive =
            href === "/"
              ? pathname === "" || pathname === "/"
              : pathname.startsWith(href.slice(1));
          return (
            <a
              class:list={[
                "hover:bg-white hover:text-black transition-all ease-in-out px-3 py-2 text-lg rounded-md",
                { "bg-white text-black": isActive },
              ]}
              href={href}
            >
              {link.title}
            </a>
          );
        })
      }
    </div>
  </div>
</nav>

<script>
  window.addEventListener("scroll", () => {
    const logo = document.getElementById("logo");
    if (!logo) return;
    if (window.scrollY > 100) {
      logo.className =
        "pt-2 pb-1 !grid !place-items-center select-none leading-none hover:bg-white bg-black scale-100 hover:text-black text-white px-4 transition-all ease-in-out";
    } else {
      logo.className =
        "pt-2 pb-1 !grid !place-items-center select-none leading-none hover:bg-black bg-white scale-110 hover:text-white text-black px-4 transition-all ease-in-out";
    }
  });

  const menuBtn = document.getElementById("mobile-menu-btn");
  const mobileMenu = document.getElementById("mobile-menu");
  const bar1 = document.getElementById("bar1");
  const bar2 = document.getElementById("bar2");
  const bar3 = document.getElementById("bar3");

  menuBtn?.addEventListener("click", () => {
    const isOpen = !mobileMenu?.classList.contains("hidden");
    mobileMenu?.classList.toggle("hidden");
    if (!isOpen) {
      bar1?.classList.add("rotate-45", "translate-y-2");
      bar2?.classList.add("opacity-0");
      bar3?.classList.add("-rotate-45", "-translate-y-2");
    } else {
      bar1?.classList.remove("rotate-45", "translate-y-2");
      bar2?.classList.remove("opacity-0");
      bar3?.classList.remove("-rotate-45", "-translate-y-2");
    }
  });
</script>
