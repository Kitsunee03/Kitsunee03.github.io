---
import { Icon } from "astro-icon/components";

type Props = {
  title: string;
  description: string;
  tags: string[];
  engine: string;
  image: string;
  gif?: string;
  link?: string;
};

const { title, description, tags, engine, image, gif, link } = Astro.props;

const engineIcons: Record<string, string> = {
  "Unity": "simple-icons:unity",
  "Unreal Engine": "simple-icons:unrealengine",
  "Phaser": "mdi:gamepad-variant-outline",
  "C++": "devicon:cplusplus",
};
---

<div class="group border border-[var(--border-color)] bg-[var(--bg-card)] hover:border-[var(--border-hover)] transition-all duration-300 overflow-hidden rounded-lg">
  <!-- Image -->
  <div class="relative overflow-hidden aspect-video bg-[var(--bg-tertiary)]">
    <!-- Placeholder (behind images, lowest z) -->
    <div class="absolute inset-0 flex items-center justify-center text-[var(--text-muted)] pointer-events-none z-0">
      <Icon name="mdi:image-outline" class="w-12 h-12 opacity-30" />
    </div>
    <!-- Static image -->
    <img
      src={image}
      alt={title}
      class:list={[
        "absolute inset-0 w-full h-full object-cover transition-all duration-500 z-[1]",
        gif ? "group-hover:opacity-0 group-hover:scale-105" : "group-hover:scale-105",
      ]}
      loading="lazy"
      onerror="this.style.display='none'"
    />
    <!-- Animated gif on hover -->
    {gif && (
      <img
        src={gif}
        alt=""
        class="absolute inset-0 w-full h-full object-cover opacity-0 group-hover:opacity-100 transition-opacity duration-300 z-[2]"
        loading="lazy"
      />
    )}
    <!-- Engine badge -->
    <div class="absolute top-3 right-3 flex items-center gap-1.5 bg-black/80 backdrop-blur-sm px-2 py-1 text-xs rounded-md z-10">
      <Icon name={engineIcons[engine] || "mdi:gamepad-variant"} class="w-3.5 h-3.5" />
      <span>{engine}</span>
    </div>
  </div>

  <!-- Content -->
  <div class="p-5 space-y-3">
    <h3 class="text-xl font-bold group-hover:text-white transition-colors">{title}</h3>

    <!-- Tags -->
    <div class="flex flex-wrap gap-1.5">
      {tags.map((tag) => (
        <span class="bg-white/10 text-[var(--text-secondary)] text-xs px-2 py-0.5 rounded-full">
          {tag}
        </span>
      ))}
    </div>

    <p class="text-[var(--text-muted)] text-sm leading-relaxed line-clamp-2 group-hover:line-clamp-none transition-all duration-300">{description}</p>

    {link && (
      <a
        href={link}
        target="_blank"
        rel="noopener noreferrer"
        class="inline-flex items-center gap-2 text-sm text-[var(--text-secondary)] hover:text-white transition-colors pt-1"
      >
        <span>View Project</span>
        <Icon name="mdi:arrow-top-right" class="w-4 h-4" />
      </a>
    )}
  </div>
</div>
